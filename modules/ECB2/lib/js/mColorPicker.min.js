/*
  mColorPicker
  Version: 1.0 r39

  Copyright (c) 2010 Meta100 LLC.
  http://www.meta100.com/

  Licensed under the MIT license
  http://www.opensource.org/licenses/mit-license.php
*/
!function(a){var b,c,d,e,f=a(document),g=a("<div>"),h=a("<div>"),i=a("<div>"),j=a("<input>"),k=/^rgb[a]?\((\d+),\s*(\d+),\s*(\d+)(,\s*(\d+\.\d+)*)?\)/,l=/([a-f0-9])([a-f0-9])([a-f0-9])/,m=/#[a-f0-9]{3}/,n=/#[a-f0-9]{6}/;a.fn.mColorPicker=function(d){var e=a.fn.mColorPicker.getCookie("swatches");return b=a.extend(a.fn.mColorPicker.defaults,d),a.fn.mColorPicker.defaults.swatches.concat(b.swatches).slice(-10),c.enhancedSwatches&&e&&(b.swatches=e.split("||").concat(b.swatches).slice(0,10)||b.swatches),a("div#mColorPicker").length||a.fn.mColorPicker.drawPicker(),a("#css_disabled_color_picker").length||a("head").prepend('<meta data-remove-me="true"/><style id="css_disabled_color_picker" type="text/css">.mColorPicker[disabled] + span, .mColorPicker[disabled="disabled"] + span, .mColorPicker[disabled="true"] + span {filter:alpha(opacity=50);-moz-opacity:0.5;-webkit-opacity:0.5;-khtml-opacity: 0.5;opacity: 0.5;cursor:default;}</style>'),a("meta[data-remove-me=true]").remove(),this.each(a.fn.mColorPicker.drawPickerTriggers),this},a.fn.mColorPicker.init={replace:"[type=color]",index:0,enhancedSwatches:!0,allowTransparency:!0,slogan:"Meta100 - Designing Fun",showLogo:!0},a.fn.mColorPicker.defaults={currentId:!1,currentInput:!1,currentColor:!1,changeColor:!1,color:!1,imageFolder:"images/",swatches:"#ffffff,#ffff00,#00ff00,#00ffff,#0000ff,#ff00ff,#ff0000,#4c2b11,#3b3b3b,#000000".split(",")},a.fn.mColorPicker.start=function(){a('input[data-mcolorpicker!="true"]').filter(function(){return"[type=color]"==c.replace?"color"==this.getAttribute("type"):a(this).is(c.replace)}).mColorPicker()},a.fn.mColorPicker.events=function(){a("#mColorPickerBg").live("click",a.fn.mColorPicker.closePicker),a(".mColorPicker").live("keyup",function(){try{a(this).css({"background-color":a(this).val()}).css({color:a.fn.mColorPicker.textColor(a(this).css("background-color"))}).trigger("change")}catch(a){}}),a(".mColorPickerTrigger").live("click",a.fn.mColorPicker.colorShow),a(".mColor, .mPastColor").live("mousemove",function(c){if(!b.changeColor)return!1;var d=a(this),e=d.offset(),f=b.currentInput,f=f.attr("data-hex")||f.attr("hex");b.color=d.css("background-color"),d.hasClass("mPastColor")?b.color=a.fn.mColorPicker.setColor(b.color,f):d.hasClass("mColorTransparent")?b.color="transparent":d.hasClass("mPastColor")||(b.color=a.fn.mColorPicker.whichColor(c.pageX-e.left,c.pageY-e.top,f)),b.currentInput.mSetInputColor(b.color)}).live("click",a.fn.mColorPicker.colorPicked),a("#mColorPickerInput").live("keyup",function(c){try{b.color=a(this).val(),b.currentInput.mSetInputColor(b.color),13==c.which&&a.fn.mColorPicker.colorPicked()}catch(a){}}).live("blur",function(){b.currentInput.mSetInputColor(b.color)}),a("#mColorPickerWrapper").live("mouseleave",function(){if(!b.changeColor)return!1;var c=b.currentInput;b.currentInput.mSetInputColor(a.fn.mColorPicker.setColor(b.currentColor,c.attr("data-hex")||c.attr("hex")))})},a.fn.mColorPicker.drawPickerTriggers=function(){var d=a(this),f=d.attr("id")||"color_"+c.index++,g="hidden"==d.attr("text")||"hidden"==d.attr("data-text"),h=a.fn.mColorPicker.setColor(d.val(),d.attr("data-hex")||d.attr("hex")),i=d.width(),j=d.height(),k=d.css("float"),l=a("<span>"),m=a("<span>"),n="";return l.attr({id:"color_work_area",class:"mColorPickerInput"}).appendTo(e),m.attr({id:"mcp_"+f,class:"mColorPickerTrigger"}).css({display:"inline-block",cursor:"pointer"}).insertAfter(d),a("<img>").attr({src:b.imageFolder+"color.png"}).css({border:0,margin:"0 0 0 3px","vertical-align":"text-bottom"}).appendTo(m),l.append(d),n=l.html().replace(/type=[^a-z ]*color[^a-z \/\/>]*/gi,'type="'+(g?"hidden":"text")+'"'),l.html("").remove(),d=a(n).attr("id",f).addClass("mColorPicker").val(h).insertBefore(m),g&&m.css({border:"1px solid black",float:k,width:i,height:j}).addClass(d.attr("class")).html("&nbsp;"),d.mSetInputColor(h),d},a.fn.mColorPicker.drawPicker=function(){var f=a("<div>"),l=(a("<a>"),a("<div>")),m=a("<div>");for(h.attr({id:"mColorPickerBg"}).css({display:"none",background:"black",opacity:.01,position:"absolute",top:0,right:0,bottom:0,left:0}).appendTo(e),g.attr({id:"mColorPicker","data-mcolorpicker":!0}).css({position:"absolute",border:"1px solid #ccc",color:"#fff",width:"194px",height:"184px","font-size":"12px","font-family":"times",display:"none"}).appendTo(e),i.attr({id:"mColorPickerTest"}).css({display:"none"}).appendTo(e),m.attr({id:"mColorPickerWrapper"}).css({position:"relative",border:"solid 1px gray"}).appendTo(g),a("<div>").attr({id:"mColorPickerImg",class:"mColor"}).css({height:"136px",width:"192px",border:0,cursor:"crosshair","background-image":"url("+b.imageFolder+"picker.png)"}).appendTo(m),f.attr({id:"mColorPickerSwatches"}).css({"border-right":"1px solid #000"}).appendTo(m),a("<div>").addClass("mClear").css({clear:"both"}).appendTo(f),d=9;-1<d;d--)a("<div>").attr({id:"cell"+d,class:"mPastColor"+(0<d?" mNoLeftBorder":"")}).css({"background-color":b.swatches[d].toLowerCase(),height:"18px",width:"18px",border:"1px solid #000",float:"left"}).html("&nbsp;").prependTo(f);l.attr({id:"mColorPickerFooter"}).css({"background-image":"url("+b.imageFolder+"grid.gif)",position:"relative"}).appendTo(m),j.attr({id:"mColorPickerInput",type:"text"}).css({border:"solid 1px gray","font-size":"10pt",margin:"3px",width:"80px"}).appendTo(l),c.allowTransparency&&a("<span>").attr({id:"mColorPickerTransparent",class:"mColor mColorTransparent"}).css({"font-size":"16px",color:"#000","padding-right":"10px","padding-top":"6px",cursor:"pointer",overflow:"hidden",float:"right"}).text("transparent").appendTo(l),a(".mNoLeftBorder").css({"border-left":0})},a.fn.mColorPicker.closePicker=function(){h.hide(),g.fadeOut()},a.fn.mColorPicker.colorShow=function(){var c=a(this),d=c.attr("id").replace("mcp_",""),e=c.offset(),i=a("#"+d),k=e.top+c.outerHeight(),l=e.left;if(i.attr("disabled"))return!1;b.currentColor=i.css("background-color"),b.changeColor=!0,b.currentInput=i,b.currentId=d,k+g.height()>f.height()&&(k=e.top-g.height()),l+g.width()>f.width()&&(l=e.left-g.width()+c.outerWidth()),g.css({top:k+"px",left:l+"px"}).fadeIn("fast"),h.show(),b.color=a("#"+d).attr("data-text")?c.css("background-color"):i.css("background-color"),b.color=a.fn.mColorPicker.setColor(b.color,i.attr("data-hex")||i.attr("hex")),j.val(b.color)},a.fn.mColorPicker.setInputColor=function(b,c){a("#"+b).mSetInputColor(c)},a.fn.mSetInputColor=function(c){var d=a(this),e={"background-color":c,"background-image":"transparent"==c?"url('"+b.imageFolder+"grid.gif')":"",color:a.fn.mColorPicker.textColor(c)};(d.attr("data-text")||d.attr("text"))&&d.next().css(e),d.val(c).css(e).trigger("change"),j.val(c)},a.fn.mColorPicker.textColor=function(b){return b=a.fn.mColorPicker.RGBtoHex(b),void 0===b||"transparent"==b?"black":400>parseInt(b.substr(1,2),16)+parseInt(b.substr(3,2),16)+parseInt(b.substr(5,2),16)?"white":"black"},a.fn.mColorPicker.setCookie=function(a,b,c){a=a+"="+escape(b),b=new Date,b.setDate(b.getDate()+c),a+="; expires="+b.toGMTString(),document.cookie=a},a.fn.mColorPicker.getCookie=function(a){return(a=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)"))?unescape(a[2]):null},a.fn.mColorPicker.colorPicked=function(){b.changeColor=!1,a.fn.mColorPicker.closePicker(),a.fn.mColorPicker.addToSwatch(),b.currentInput.trigger("colorpicked")},a.fn.mColorPicker.addToSwatch=function(e){if(!c.enhancedSwatches)return!1;var f=[];d=0,"string"==typeof e&&(b.color=e),"transparent"!=b.color&&(f[0]=a.fn.mColorPicker.hexToRGB(b.color)),a(".mPastColor").each(function(){var c=a(this);b.color=a.fn.mColorPicker.hexToRGB(c.css("background-color")),b.color!=f[0]&&f.length<10&&(f[f.length]=b.color),c.css("background-color",f[d++])}),c.enhancedSwatches&&a.fn.mColorPicker.setCookie("swatches",f.join("||"),365)},a.fn.mColorPicker.whichColor=function(b,c,d){var e=[255,255,255];32>b?(e[1]=8*b,e[2]=0):64>b?(e[0]=256-8*(b-32),e[2]=0):96>b?(e[0]=0,e[2]=8*(b-64)):128>b?(e[0]=0,e[1]=256-8*(b-96)):160>b?(e[0]=8*(b-128),e[1]=0):(e[1]=0,e[2]=256-8*(b-160));for(var f=0;3>f;f++)64>c?e[f]+=(256-e[f])*(64-c)/64:128>=c?e[f]-=e[f]*(c-64)/64:128<c&&(e[f]=256-b/192*256),e[f]=Math.round(Math.min(e[f],255)),"true"==d&&(e[f]=a.fn.mColorPicker.decToHex(e[f]));return"true"==d?"#"+e.join(""):"rgb("+e.join(", ")+")"},a.fn.mColorPicker.setColor=function(b,c){return"true"==c?a.fn.mColorPicker.RGBtoHex(b):a.fn.mColorPicker.hexToRGB(b)},a.fn.mColorPicker.colorTest=function(a){return i.css("background-color",a),i.css("background-color")},a.fn.mColorPicker.decToHex=function(a){return a=parseInt(a),"0123456789ABCDEF".charAt(Math.floor(a/16))+""+"0123456789ABCDEF".charAt(a-16*Math.floor(a/16))},a.fn.mColorPicker.RGBtoHex=function(b){var d,c="#",b=!!b&&b.toLowerCase();if(!b)return"";if(n.test(b))return b.substr(0,7);if(m.test(b))return b.replace(l,"$1$1$2$2$3$3").substr(0,7);if(d=b.match(k)){for(b=1;4>b;b++)c+=a.fn.mColorPicker.decToHex(d[b]);return c}return a.fn.mColorPicker.colorTest(b)},a.fn.mColorPicker.hexToRGB=function(b){return b=!!b&&b.toLowerCase(),b?k.test(b)?b:m.test(b)?(n.test(b)||(b=b.replace(l,"$1$1$2$2$3$3")),"rgb("+parseInt(b.substr(1,2),16)+", "+parseInt(b.substr(3,2),16)+", "+parseInt(b.substr(5,2),16)+")"):a.fn.mColorPicker.colorTest(b):""},c=a.fn.mColorPicker.init,f.ready(function(){e=a("body"),a.fn.mColorPicker.events(),c.replace&&("function"==typeof a.fn.mDOMupdate?a("input").mDOMupdate(a.fn.mColorPicker.start):"function"==typeof a.fn.livequery?a("input").livequery(a.fn.mColorPicker.start):(a.fn.mColorPicker.start(),f.live("ajaxSuccess.mColorPicker",a.fn.mColorPicker.start)))})}(jQuery);